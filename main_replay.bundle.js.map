{"version":3,"file":"main_replay.bundle.js","mappings":"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","sources":["webpack://pikachu-volleyball/./src/resources/js/replay/pikavolley_replay.js","webpack://pikachu-volleyball/./src/resources/js/replay/ui_replay.js","webpack://pikachu-volleyball/./src/resources/js/replay/replay_player.js","webpack://pikachu-volleyball/./src/resources/js/replay/main_replay.js"],"sourcesContent":["import seedrandom from 'seedrandom';\r\nimport { PikachuVolleyball } from '../pikavolley.js';\r\nimport { setCustomRng } from '../rand.js';\r\nimport { Cloud, Wave } from '../cloud_and_wave.js';\r\nimport { PikaPhysics } from '../physics.js';\r\nimport { convert5bitNumberToUserInput } from '../utils/input_conversion.js';\r\nimport {\r\n  noticeEndOfReplay,\r\n  moveScrubberTo,\r\n  showKeyboardInputs,\r\n} from './ui_replay.js';\r\nimport { setTickerMaxFPSAccordingToNormalFPS } from './replay_player.js';\r\n\r\n/** @typedef GameState @type {function():void} */\r\n\r\n/**\r\n * Class representing Pikachu Volleyball Replay\r\n */\r\n// @ts-ignore\r\nexport class PikachuVolleyballReplay extends PikachuVolleyball {\r\n  constructor(\r\n    stage,\r\n    resources,\r\n    roomId,\r\n    nicknames,\r\n    partialPublicIPs,\r\n    inputs,\r\n    options,\r\n    chats,\r\n  ) {\r\n    super(stage, resources);\r\n    this.noInputFrameTotal.menu = Infinity;\r\n\r\n    this.roomId = roomId;\r\n    this.nicknames = nicknames;\r\n    this.partialPublicIPs = partialPublicIPs;\r\n    this.inputs = inputs;\r\n    this.options = options;\r\n    this.chats = chats;\r\n    this.player1Keyboard = {\r\n      xDirection: 0,\r\n      yDirection: 0,\r\n      powerHit: 0,\r\n      getInput: () => {},\r\n    };\r\n    this.player2Keyboard = {\r\n      xDirection: 0,\r\n      yDirection: 0,\r\n      powerHit: 0,\r\n      getInput: () => {},\r\n    };\r\n    this.keyboardArray = [this.player1Keyboard, this.player2Keyboard];\r\n    this.willDisplayChat = true;\r\n\r\n    const fakeSound = {\r\n      play: () => {},\r\n      stop: () => {},\r\n    };\r\n    const fakeBGM = {\r\n      fake: true,\r\n      center: {\r\n        isPlaying: false,\r\n      },\r\n      play: function () {\r\n        this.center.isPlaying = true;\r\n      },\r\n      stop: function () {\r\n        this.center.isPlaying = false;\r\n      },\r\n    };\r\n    this.fakeAudio = {\r\n      sounds: {\r\n        bgm: fakeBGM,\r\n        pipikachu: fakeSound,\r\n        pika: fakeSound,\r\n        chu: fakeSound,\r\n        pi: fakeSound,\r\n        pikachu: fakeSound,\r\n        powerHit: fakeSound,\r\n        ballTouchesGround: fakeSound,\r\n      },\r\n    };\r\n\r\n    this.initializeForReplay();\r\n  }\r\n\r\n  /**\r\n   * This is mainly for reinitialization for reusing the PikachuVolleyballReplay object\r\n   */\r\n  initializeForReplay() {\r\n    // Stop if sounds are playing\r\n    for (const prop in this.audio.sounds) {\r\n      this.audio.sounds[prop].stop();\r\n    }\r\n\r\n    this.timeCurrent = 0; // unit: second\r\n    this.timeBGM = 0;\r\n    this.isBGMPlaying = false;\r\n    this.replayFrameCounter = 0;\r\n    this.chatCounter = 0;\r\n    this.optionsCounter = 0;\r\n\r\n    // Set the same RNG (used for the game) for both peers\r\n    const customRng = seedrandom.alea(this.roomId.slice(8));\r\n    setCustomRng(customRng);\r\n\r\n    // Reinitialize things which needs exact RNG\r\n    this.view.game.cloudArray = [];\r\n    const NUM_OF_CLOUDS = 10;\r\n    for (let i = 0; i < NUM_OF_CLOUDS; i++) {\r\n      this.view.game.cloudArray.push(new Cloud());\r\n    }\r\n    this.view.game.wave = new Wave();\r\n    this.view.intro.visible = false;\r\n    this.view.menu.visible = false;\r\n    this.view.game.visible = false;\r\n    this.view.fadeInOut.visible = false;\r\n    \r\n    this.physics = new PikaPhysics(true, true);\r\n\r\n    this.normalFPS = 25;\r\n    this.slowMotionFPS = 5;\r\n    this.SLOW_MOTION_FRAMES_NUM = 6;\r\n    this.slowMotionFramesLeft = 0;\r\n    this.slowMotionNumOfSkippedFrames = 0;\r\n    this.selectedWithWho = 0;\r\n    this.scores = [0, 0];\r\n    this.winningScore = 15;\r\n    this.gameEnded = false;\r\n    this.roundEnded = false;\r\n    this.isPlayer2Serve = false;\r\n    this.frameCounter = 0;\r\n    this.noInputFrameCounter = 0;\r\n\r\n    this.paused = false;\r\n    this.isStereoSound = true;\r\n    this._isPracticeMode = false;\r\n    this.isRoomCreatorPlayer2 = false;\r\n    this.state = this.intro;\r\n  }\r\n\r\n  /**\r\n   * Override the \"intro\" method in the super class.\r\n   * It is to ask for one more game with the peer after quick match game ends.\r\n   * @type {GameState}\r\n   */\r\n  intro() {\r\n    if (this.frameCounter === 0) {\r\n      this.selectedWithWho = 0;\r\n    }\r\n    super.intro();\r\n  }\r\n\r\n  /**\r\n   * Override the \"menu\" method in the super class.\r\n   * It changes \"am I player 1 or player 2\" setting accordingly.\r\n   * @type {GameState}\r\n   */\r\n  menu() {\r\n    const selectedWithWho = this.selectedWithWho;\r\n    super.menu();\r\n    if (this.selectedWithWho !== selectedWithWho) {\r\n      this.isRoomCreatorPlayer2 = !this.isRoomCreatorPlayer2;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Game loop which play no sound, display no chat, does not move scrubber\r\n   */\r\n  gameLoopSilent() {\r\n    const audio = this.audio;\r\n    this.willDisplayChat = false;\r\n    // @ts-ignore\r\n    this.audio = this.fakeAudio;\r\n    this.gameLoop();\r\n    this.willDisplayChat = true;\r\n    this.audio = audio;\r\n  }\r\n\r\n  /**\r\n   * Game loop\r\n   * This function should be called at regular intervals ( interval = (1 / FPS) second )\r\n   */\r\n  gameLoop() {\r\n    if (this.replayFrameCounter >= this.inputs.length) {\r\n      noticeEndOfReplay();\r\n      return;\r\n    }\r\n\r\n    moveScrubberTo(this.replayFrameCounter);\r\n\r\n    const usersInputNumber = this.inputs[this.replayFrameCounter];\r\n    const player1Input = convert5bitNumberToUserInput(usersInputNumber >>> 5);\r\n    const player2Input = convert5bitNumberToUserInput(\r\n      usersInputNumber % (1 << 5)\r\n    );\r\n    this.player1Keyboard.xDirection = player1Input.xDirection;\r\n    this.player1Keyboard.yDirection = player1Input.yDirection;\r\n    this.player1Keyboard.powerHit = player1Input.powerHit;\r\n    this.player2Keyboard.xDirection = player2Input.xDirection;\r\n    this.player2Keyboard.yDirection = player2Input.yDirection;\r\n    this.player2Keyboard.powerHit = player2Input.powerHit;\r\n    showKeyboardInputs(player1Input, player2Input);\r\n\r\n    let options = this.options[this.optionsCounter];\r\n    while (options && options[0] === this.replayFrameCounter) {\r\n      if (options[1].speed) {\r\n        switch (options[1].speed) {\r\n          case 'slow':\r\n            this.normalFPS = 20;\r\n            break;\r\n          case 'medium':\r\n            this.normalFPS = 25;\r\n            break;\r\n          case 'fast':\r\n            this.normalFPS = 30;\r\n            break;\r\n        }\r\n        setTickerMaxFPSAccordingToNormalFPS(this.normalFPS);\r\n      }\r\n      if (options[1].winningScore) {\r\n        switch (options[1].winningScore) {\r\n          case 5:\r\n            this.winningScore = 5;\r\n            break;\r\n          case 10:\r\n            this.winningScore = 10;\r\n            break;\r\n          case 15:\r\n            this.winningScore = 15;\r\n            break;\r\n        }\r\n      }\r\n      this.optionsCounter++;\r\n      options = this.options[this.optionsCounter];\r\n    }\r\n    this.timeCurrent += 1 / this.normalFPS;\r\n\r\n    this.isBGMPlaying = this.audio.sounds.bgm.center.isPlaying;\r\n    if (this.isBGMPlaying) {\r\n      this.timeBGM = (this.timeBGM + 1 / this.normalFPS) % 83; // 83 is total duration of bgm\r\n    } else {\r\n      this.timeBGM = 0;\r\n    }\r\n\r\n    let chat = this.chats[this.chatCounter];\r\n    while (chat && chat[0] === this.replayFrameCounter) {\r\n      this.chatCounter++;\r\n      chat = this.chats[this.chatCounter];\r\n    }\r\n\r\n    this.replayFrameCounter++;\r\n    super.gameLoop();\r\n  }\r\n}","import { replayPlayer } from './replay_player.js';\r\nimport '../../style.css';\r\n\r\n/** @typedef {import('../physics.js').PikaUserInput} PikaUserInput */\r\n\r\nlet pausedByBtn = false;\r\nlet isUserScrubbing = false;\r\n\r\nconst scrubberRangeInput = document.getElementById('scrubber-range-input');\r\nconst playPauseBtn = document.getElementById('play-pause-btn');\r\nconst seekBackward1Btn = document.getElementById('seek-backward-1');\r\nconst seekForward1Btn = document.getElementById('seek-forward-1');\r\nconst seekBackward3Btn = document.getElementById('seek-backward-3');\r\nconst seekForward3Btn = document.getElementById('seek-forward-3');\r\nconst speedBtn5FPS = document.getElementById('speed-btn-5-fps');\r\nconst speedBtnHalfTimes = document.getElementById('speed-btn-half-times');\r\nconst speedBtn1Times = document.getElementById('speed-btn-1-times');\r\nconst speedBtn2Times = document.getElementById('speed-btn-2-times');\r\n\r\nexport function setUpUI() {\r\n  disableReplayScrubberAndBtns();\r\n\r\n  // File input code is from: https://developer.mozilla.org/en-US/docs/Web/API/File/Using_files_from_web_applications\r\n  const fileInputElement = document.getElementById('file-input');\r\n  fileInputElement.addEventListener('change', (e) => {\r\n    document.getElementById('loading-box').classList.remove('hidden');\r\n    dropbox.classList.add('hidden');\r\n    // @ts-ignore\r\n    handleFiles(e.target.files);\r\n  });\r\n\r\n  // Dropbox code is from: https://developer.mozilla.org/en-US/docs/Web/API/File/Using_files_from_web_applications\r\n  const dropbox = document.getElementById('dropbox');\r\n  dropbox.addEventListener('dragenter', dragenter, false);\r\n  dropbox.addEventListener('dragover', dragover, false);\r\n  dropbox.addEventListener('drop', drop, false);\r\n  function dragenter(e) {\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n  }\r\n  function dragover(e) {\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n  }\r\n  function drop(e) {\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n\r\n    const dt = e.dataTransfer;\r\n    const files = dt.files;\r\n\r\n    document.getElementById('loading-box').classList.remove('hidden');\r\n    dropbox.classList.add('hidden');\r\n\r\n    handleFiles(files);\r\n  }\r\n  function handleFiles(files) {\r\n    replayPlayer.readFile(files[0]);\r\n  }\r\n\r\n  scrubberRangeInput.addEventListener('touchstart', () => {\r\n    isUserScrubbing = true;\r\n    if (replayPlayer.ticker.started) {\r\n      replayPlayer.ticker.stop();\r\n      replayPlayer.stopBGM();\r\n    }\r\n  });\r\n  scrubberRangeInput.addEventListener('mousedown', () => {\r\n    isUserScrubbing = true;\r\n    if (replayPlayer.ticker.started) {\r\n      replayPlayer.ticker.stop();\r\n      replayPlayer.stopBGM();\r\n    }\r\n  });\r\n  scrubberRangeInput.addEventListener('touchend', () => {\r\n    if (!pausedByBtn && !replayPlayer.ticker.started) {\r\n      replayPlayer.ticker.start();\r\n      replayPlayer.playBGMProperly();\r\n    }\r\n  });\r\n  scrubberRangeInput.addEventListener('mouseup', () => {\r\n    if (!pausedByBtn && !replayPlayer.ticker.started) {\r\n      replayPlayer.ticker.start();\r\n      replayPlayer.playBGMProperly();\r\n    }\r\n  });\r\n  //scrubberRangeInput.addEventListener('input', (e) => {\r\n    // @ts-ignore\r\n  //  replayPlayer.seekFrame(Number(e.currentTarget.value));\r\n  //});\r\n\r\n  scrubberRangeInput.addEventListener('change', (e) => {\r\n  // @ts-ignore\r\n  const targetFrame = Number(e.currentTarget.value);\r\n  replayPlayer.seekFrame(targetFrame);\r\n  console.log(targetFrame);\r\n  \r\n  // 마우스를 놓았으니, isUserScrubbing을 false로 설정합니다.\r\n  isUserScrubbing = false; \r\n\r\n  // (중요) 마우스를 놓은 위치에서 즉시 재생을 다시 시작합니다.\r\n  if (!pausedByBtn && !replayPlayer.ticker.started) {\r\n    replayPlayer.ticker.start();\r\n    replayPlayer.playBGMProperly();\r\n  }\r\n});\r\n\r\n  // @ts-ignore\r\n  playPauseBtn.disabled = true;\r\n  playPauseBtn.addEventListener('click', () => {\r\n    if (replayPlayer.ticker.started) {\r\n      replayPlayer.ticker.stop();\r\n      replayPlayer.stopBGM();\r\n      pausedByBtn = true;\r\n      adjustPlayPauseBtnIcon();\r\n    } else {\r\n      replayPlayer.ticker.start();\r\n      replayPlayer.playBGMProperly();\r\n      pausedByBtn = false;\r\n      adjustPlayPauseBtnIcon();\r\n    }\r\n  });\r\n\r\n  seekBackward1Btn.addEventListener('click', () => {\r\n    replayPlayer.seekRelativeTime(-1);\r\n    if (!pausedByBtn && !replayPlayer.ticker.started) {\r\n      replayPlayer.ticker.start();\r\n      replayPlayer.playBGMProperly();\r\n    }\r\n  });\r\n  seekForward1Btn.addEventListener('click', () => {\r\n    replayPlayer.seekRelativeTime(1);\r\n    if (!pausedByBtn && !replayPlayer.ticker.started) {\r\n      replayPlayer.ticker.start();\r\n      replayPlayer.playBGMProperly();\r\n    }\r\n  });\r\n  seekBackward3Btn.addEventListener('click', () => {\r\n    replayPlayer.seekRelativeTime(-3);\r\n    if (!pausedByBtn && !replayPlayer.ticker.started) {\r\n      replayPlayer.ticker.start();\r\n      replayPlayer.playBGMProperly();\r\n    }\r\n  });\r\n  seekForward3Btn.addEventListener('click', () => {\r\n    replayPlayer.seekRelativeTime(3);\r\n    if (!pausedByBtn && !replayPlayer.ticker.started) {\r\n      replayPlayer.ticker.start();\r\n      replayPlayer.playBGMProperly();\r\n    }\r\n  });\r\n\r\n  speedBtn5FPS.addEventListener('click', (e) => {\r\n    processSelected(e);\r\n    replayPlayer.adjustPlaybackSpeedFPS(5);\r\n  });\r\n  speedBtnHalfTimes.addEventListener('click', (e) => {\r\n    processSelected(e);\r\n    replayPlayer.adjustPlaybackSpeedTimes(0.5);\r\n  });\r\n  speedBtn1Times.addEventListener('click', (e) => {\r\n    processSelected(e);\r\n    replayPlayer.adjustPlaybackSpeedTimes(1);\r\n  });\r\n  speedBtn2Times.addEventListener('click', (e) => {\r\n    processSelected(e);\r\n    replayPlayer.adjustPlaybackSpeedTimes(2);\r\n  });\r\n  function processSelected(e) {\r\n    unselectSpeedBtns();\r\n    // @ts-ignore\r\n    e.currentTarget.classList.add('selected');\r\n  }\r\n  function unselectSpeedBtns() {\r\n    for (const btn of [\r\n      speedBtn5FPS,\r\n      speedBtnHalfTimes,\r\n      speedBtn1Times,\r\n      speedBtn2Times,\r\n    ]) {\r\n      btn.classList.remove('selected');\r\n    }\r\n  }\r\n\r\n  const fpsInput = document.getElementById('fps-input');\r\n  fpsInput.addEventListener('change', (e) => {\r\n    // @ts-ignore\r\n    let value = e.target.value;\r\n    if (value < 0) {\r\n      value = 0;\r\n    } else if (value > 60) {\r\n      value = 60;\r\n    }\r\n    replayPlayer.adjustPlaybackSpeedFPS(value);\r\n    unselectSpeedBtns();\r\n  });\r\n\r\n  const noticeBoxEndOfReplayOKBtn = document.getElementById(\r\n    'notice-end-of-replay-ok-btn'\r\n  );\r\n  noticeBoxEndOfReplayOKBtn.addEventListener('click', () => {\r\n    location.reload();\r\n  });\r\n\r\n  const noticeBoxFileErrorOKBtn = document.getElementById(\r\n    'notice-file-open-error-ok-btn'\r\n  );\r\n  noticeBoxFileErrorOKBtn.addEventListener('click', () => {\r\n    location.reload();\r\n  });\r\n\r\n  const keyboardContainer = document.getElementById('keyboard-container');\r\n  const showKeyboardCheckbox = document.getElementById(\r\n    'show-keyboard-checkbox'\r\n  );\r\n  showKeyboardCheckbox.addEventListener('change', () => {\r\n    // @ts-ignore\r\n    if (showKeyboardCheckbox.checked) {\r\n      keyboardContainer.classList.remove('hidden');\r\n    } else {\r\n      keyboardContainer.classList.add('hidden');\r\n    }\r\n  });\r\n\r\n  const showNicknamesCheckbox = document.getElementById(\r\n    'show-nicknames-checkbox'\r\n  );\r\n  const player1NicknameElem = document.getElementById('player1-nickname');\r\n  const player2NicknameElem = document.getElementById('player2-nickname');\r\n  showNicknamesCheckbox.addEventListener('change', () => {\r\n    // @ts-ignore\r\n    if (showNicknamesCheckbox.checked) {\r\n      player1NicknameElem.classList.remove('hidden');\r\n      player2NicknameElem.classList.remove('hidden');\r\n    } else {\r\n      player1NicknameElem.classList.add('hidden');\r\n      player2NicknameElem.classList.add('hidden');\r\n    }\r\n  });\r\n\r\n  const showIPsCheckbox = document.getElementById('show-ip-addresses-checkbox');\r\n  const player1IPElem = document.getElementById('player1-partial-ip');\r\n  const player2IPElem = document.getElementById('player2-partial-ip');\r\n  showIPsCheckbox.addEventListener('change', () => {\r\n    // @ts-ignore\r\n    if (showIPsCheckbox.checked) {\r\n      player1IPElem.classList.remove('hidden');\r\n      player2IPElem.classList.remove('hidden');\r\n    } else {\r\n      player1IPElem.classList.add('hidden');\r\n      player2IPElem.classList.add('hidden');\r\n    }\r\n  });\r\n\r\n  const turnOnBGMCheckbox = document.getElementById('turn-on-bgm-checkbox');\r\n  turnOnBGMCheckbox.addEventListener('change', () => {\r\n    if (replayPlayer.pikaVolley === null) {\r\n      return;\r\n    }\r\n    // @ts-ignore\r\n    if (turnOnBGMCheckbox.checked) {\r\n      replayPlayer.pikaVolley.audio.turnBGMVolume(true);\r\n    } else {\r\n      replayPlayer.pikaVolley.audio.turnBGMVolume(false);\r\n    }\r\n  });\r\n\r\n  const turnOnSFXCheckbox = document.getElementById('turn-on-sfx-checkbox');\r\n  turnOnSFXCheckbox.addEventListener('change', () => {\r\n    if (replayPlayer.pikaVolley === null) {\r\n      return;\r\n    }\r\n    // @ts-ignore\r\n    if (turnOnSFXCheckbox.checked) {\r\n      replayPlayer.pikaVolley.audio.turnSFXVolume(true);\r\n    } else {\r\n      replayPlayer.pikaVolley.audio.turnSFXVolume(false);\r\n    }\r\n  });\r\n\r\n  const graphicSharpCheckbox = document.getElementById(\r\n    'graphic-sharp-checkbox'\r\n  );\r\n  graphicSharpCheckbox.addEventListener('change', () => {\r\n    if (replayPlayer.pikaVolley === null) {\r\n      return;\r\n    }\r\n    // @ts-ignore\r\n    if (graphicSharpCheckbox.checked) {\r\n      document\r\n        .querySelector('#game-canvas-container>canvas')\r\n        .classList.remove('graphic-soft');\r\n    } else {\r\n      document\r\n        .querySelector('#game-canvas-container>canvas')\r\n        .classList.add('graphic-soft');\r\n    }\r\n  });\r\n\r\n  window.addEventListener('keydown', (event) => {\r\n    if (event.code === 'Space') {\r\n      event.preventDefault();\r\n      playPauseBtn.click();\r\n    } else if (event.code === 'ArrowLeft') {\r\n      event.preventDefault();\r\n      seekBackward3Btn.click();\r\n    } else if (event.code === 'ArrowRight') {\r\n      event.preventDefault();\r\n      seekForward3Btn.click();\r\n    }\r\n  });\r\n}\r\n\r\nexport function adjustFPSInputValue() {\r\n  const fpsInput = document.getElementById('fps-input');\r\n  // @ts-ignore\r\n  fpsInput.value = replayPlayer.ticker.maxFPS;\r\n}\r\n\r\nexport function adjustPlayPauseBtnIcon() {\r\n  const playPauseBtn = document.getElementById('play-pause-btn');\r\n  if (replayPlayer.ticker.started) {\r\n    playPauseBtn.textContent =\r\n      document.getElementById('pause-mark').textContent;\r\n  } else {\r\n    playPauseBtn.textContent = document.getElementById('play-mark').textContent;\r\n  }\r\n}\r\n\r\nexport function noticeEndOfReplay() {\r\n  const noticeBoxEndOfReplay = document.getElementById('notice-end-of-replay');\r\n  noticeBoxEndOfReplay.classList.remove('hidden');\r\n}\r\n\r\nexport function hideNoticeEndOfReplay() {\r\n  const noticeBoxEndOfReplay = document.getElementById('notice-end-of-replay');\r\n  noticeBoxEndOfReplay.classList.add('hidden');\r\n}\r\n\r\nexport function noticeFileOpenError() {\r\n  const noticeBoxFileOpenError = document.getElementById(\r\n    'notice-file-open-error'\r\n  );\r\n  noticeBoxFileOpenError.classList.remove('hidden');\r\n}\r\n\r\nexport function getCommentText() {\r\n  return document.getElementById('replay-viewer-at').textContent;\r\n}\r\n\r\nexport function setMaxForScrubberRange(max) {\r\n  // @ts-ignore\r\n  scrubberRangeInput.max = max;\r\n}\r\n\r\nexport function moveScrubberTo(value) {\r\n  /**if (isUserScrubbing) {\r\n    return;\r\n  }*/\r\n  // @ts-ignore\r\n  scrubberRangeInput.value = value;\r\n}\r\n\r\n/**\r\n *\r\n * @param {number} timeCurrent unit: second\r\n */\r\nexport function showTimeCurrent(timeCurrent) {\r\n  document.getElementById('time-current').textContent =\r\n    getTimeText(timeCurrent);\r\n}\r\n\r\n/**\r\n *\r\n * @param {number} timeDuration unit: second\r\n */\r\nexport function showTotalTimeDuration(timeDuration) {\r\n  document.getElementById('time-duration').textContent =\r\n    getTimeText(timeDuration);\r\n}\r\n\r\n/**\r\n * Show Keyboard inputs\r\n * @param {PikaUserInput} player1Input\r\n * @param {PikaUserInput} player2Input\r\n */\r\nexport function showKeyboardInputs(player1Input, player2Input) {\r\n  const zKey = document.getElementById('z-key');\r\n  const rKey = document.getElementById('r-key');\r\n  const vKey = document.getElementById('v-key');\r\n  const dKey = document.getElementById('d-key');\r\n  const gKey = document.getElementById('g-key');\r\n\r\n  const enterKey = document.getElementById('enter-key');\r\n  const upKey = document.getElementById('up-key');\r\n  const downKey = document.getElementById('down-key');\r\n  const leftKey = document.getElementById('left-key');\r\n  const rightKey = document.getElementById('right-key');\r\n\r\n  function pressKeyElm(keyElm) {\r\n    keyElm.classList.add('pressed');\r\n  }\r\n\r\n  function unpressKeyElm(keyElm) {\r\n    keyElm.classList.remove('pressed');\r\n  }\r\n\r\n  switch (player1Input.xDirection) {\r\n    case 0:\r\n      unpressKeyElm(dKey);\r\n      unpressKeyElm(gKey);\r\n      break;\r\n    case -1:\r\n      pressKeyElm(dKey);\r\n      unpressKeyElm(gKey);\r\n      break;\r\n    case 1:\r\n      unpressKeyElm(dKey);\r\n      pressKeyElm(gKey);\r\n      break;\r\n  }\r\n  switch (player1Input.yDirection) {\r\n    case 0:\r\n      unpressKeyElm(rKey);\r\n      unpressKeyElm(vKey);\r\n      break;\r\n    case -1:\r\n      pressKeyElm(rKey);\r\n      unpressKeyElm(vKey);\r\n      break;\r\n    case 1:\r\n      unpressKeyElm(rKey);\r\n      pressKeyElm(vKey);\r\n      break;\r\n  }\r\n  switch (player1Input.powerHit) {\r\n    case 0:\r\n      unpressKeyElm(zKey);\r\n      break;\r\n    case 1:\r\n      pressKeyElm(zKey);\r\n      break;\r\n  }\r\n\r\n  switch (player2Input.xDirection) {\r\n    case 0:\r\n      unpressKeyElm(leftKey);\r\n      unpressKeyElm(rightKey);\r\n      break;\r\n    case -1:\r\n      pressKeyElm(leftKey);\r\n      unpressKeyElm(rightKey);\r\n      break;\r\n    case 1:\r\n      unpressKeyElm(leftKey);\r\n      pressKeyElm(rightKey);\r\n      break;\r\n  }\r\n  switch (player2Input.yDirection) {\r\n    case 0:\r\n      unpressKeyElm(upKey);\r\n      unpressKeyElm(downKey);\r\n      break;\r\n    case -1:\r\n      pressKeyElm(upKey);\r\n      unpressKeyElm(downKey);\r\n      break;\r\n    case 1:\r\n      unpressKeyElm(upKey);\r\n      pressKeyElm(downKey);\r\n      break;\r\n  }\r\n  switch (player2Input.powerHit) {\r\n    case 0:\r\n      unpressKeyElm(enterKey);\r\n      break;\r\n    case 1:\r\n      pressKeyElm(enterKey);\r\n      break;\r\n  }\r\n}\r\n\r\nexport function enableReplayScrubberAndBtns() {\r\n  // @ts-ignore\r\n  scrubberRangeInput.disabled = false;\r\n  // @ts-ignore\r\n  playPauseBtn.disabled = false;\r\n  // @ts-ignore\r\n  seekBackward1Btn.disabled = false;\r\n  // @ts-ignore\r\n  seekForward1Btn.disabled = false;\r\n  // @ts-ignore\r\n  seekBackward3Btn.disabled = false;\r\n  // @ts-ignore\r\n  seekForward3Btn.disabled = false;\r\n  // @ts-ignore\r\n  speedBtn5FPS.disabled = false;\r\n  // @ts-ignore\r\n  speedBtnHalfTimes.disabled = false;\r\n  // @ts-ignore\r\n  speedBtn1Times.disabled = false;\r\n  // @ts-ignore\r\n  speedBtn2Times.disabled = false;\r\n}\r\n\r\nfunction disableReplayScrubberAndBtns() {\r\n  // @ts-ignore\r\n  scrubberRangeInput.disabled = true;\r\n  // @ts-ignore\r\n  playPauseBtn.disabled = true;\r\n  // @ts-ignore\r\n  seekBackward1Btn.disabled = true;\r\n  // @ts-ignore\r\n  seekForward1Btn.disabled = true;\r\n  // @ts-ignore\r\n  seekBackward3Btn.disabled = true;\r\n  // @ts-ignore\r\n  seekForward3Btn.disabled = true;\r\n  // @ts-ignore\r\n  speedBtn5FPS.disabled = true;\r\n  // @ts-ignore\r\n  speedBtnHalfTimes.disabled = true;\r\n  // @ts-ignore\r\n  speedBtn1Times.disabled = true;\r\n  // @ts-ignore\r\n  speedBtn2Times.disabled = true;\r\n}\r\n\r\n/**\r\n *\r\n * @param {number} time unit: second\r\n */\r\nfunction getTimeText(time) {\r\n  const seconds = Math.floor(time % 60);\r\n  const minutes = Math.floor(time / 60) % 60;\r\n  const hours = Math.floor(Math.floor(time / 60) / 60);\r\n\r\n  if (hours > 0) {\r\n    return `${String(hours)}:${('0' + minutes).slice(-2)}:${(\r\n      '0' + seconds\r\n    ).slice(-2)}`;\r\n  } else {\r\n    return `${String(minutes)}:${('0' + seconds).slice(-2)}`;\r\n  }\r\n}\r\n","'use strict';\r\nimport { settings } from '@pixi/settings';\r\nimport { SCALE_MODES } from '@pixi/constants';\r\nimport { Renderer, BatchRenderer, autoDetectRenderer } from '@pixi/core';\r\nimport { Prepare } from '@pixi/prepare';\r\nimport { Container } from '@pixi/display';\r\nimport { Loader } from '@pixi/loaders';\r\nimport { SpritesheetLoader } from '@pixi/spritesheet';\r\nimport { Ticker } from '@pixi/ticker';\r\nimport { CanvasRenderer } from '@pixi/canvas-renderer';\r\nimport { CanvasSpriteRenderer } from '@pixi/canvas-sprite';\r\nimport { CanvasPrepare } from '@pixi/canvas-prepare';\r\nimport '@pixi/canvas-display';\r\nimport { ASSETS_PATH } from '../assets_path.js';\r\nimport { PikachuVolleyballReplay } from './pikavolley_replay.js';\r\nimport {\r\n  setMaxForScrubberRange,\r\n  adjustPlayPauseBtnIcon,\r\n  showTotalTimeDuration,\r\n  showTimeCurrent,\r\n  enableReplayScrubberAndBtns,\r\n  hideNoticeEndOfReplay,\r\n  noticeFileOpenError,\r\n  adjustFPSInputValue,\r\n} from './ui_replay.js';\r\nimport '../../style.css';\r\nimport { serialize } from '../utils/serialize.js';\r\nimport { getHashCode } from '../utils/hash_code.js';\r\n\r\nexport class ReplayPlayer {\r\n  constructor() {\r\n    // Reference for how to use Renderer.registerPlugin:\r\n    // https://github.com/pixijs/pixijs/blob/af3c0c6bb15aeb1049178c972e4a14bb4cabfce4/bundles/pixi.js/src/index.ts#L27-L34\r\n    Renderer.registerPlugin('prepare', Prepare);\r\n    Renderer.registerPlugin('batch', BatchRenderer);\r\n    // Reference for how to use CanvasRenderer.registerPlugin:\r\n    // https://github.com/pixijs/pixijs/blob/af3c0c6bb15aeb1049178c972e4a14bb4cabfce4/bundles/pixi.js-legacy/src/index.ts#L13-L19\r\n    CanvasRenderer.registerPlugin('prepare', CanvasPrepare);\r\n    CanvasRenderer.registerPlugin('sprite', CanvasSpriteRenderer);\r\n    Loader.registerPlugin(SpritesheetLoader);\r\n    settings.RESOLUTION = 2;\r\n    settings.SCALE_MODE = SCALE_MODES.NEAREST;\r\n    settings.ROUND_PIXELS = true;\r\n\r\n    this.ticker = new Ticker();\r\n    this.ticker.minFPS = 1;\r\n    this.renderer = autoDetectRenderer({\r\n      width: 432,\r\n      height: 304,\r\n      antialias: false,\r\n      backgroundColor: 0x000000,\r\n      backgroundAlpha: 1,\r\n      forceCanvas: true,\r\n    });\r\n    this.stage = new Container();\r\n    this.loader = new Loader();\r\n    this.pikaVolley = null;\r\n    this.playBackSpeedTimes = 1;\r\n    this.playBackSpeedFPS = null;\r\n  }\r\n\r\n  readFile(file) {\r\n    // To show two \"with friend\" on the menu\r\n    const TEXTURES = ASSETS_PATH.TEXTURES;\r\n    TEXTURES.WITH_COMPUTER = TEXTURES.WITH_FRIEND;\r\n\r\n    document\r\n      .querySelector('#game-canvas-container')\r\n      .appendChild(this.renderer.view);\r\n\r\n    this.renderer.render(this.stage); // To make the initial canvas painting stable in the Firefox browser.\r\n    this.ticker.add(() => {\r\n      // Redering and gameLoop order is the opposite of\r\n      // the offline web version (refer: ./offline_version_js/main.js).\r\n      // It's for the smooth rendering for the online version\r\n      // which gameLoop can not always succeed right on this \"ticker.add\"ed code\r\n      // because of the transfer delay or connection status. (If gameLoop here fails,\r\n      // it is recovered by the callback gameLoop which is called after peer input received.)\r\n      // Now the rendering is delayed 40ms (when pikaVolley.normalFPS == 25)\r\n      // behind gameLoop.\r\n      this.renderer.render(this.stage);\r\n      showTimeCurrent(this.pikaVolley.timeCurrent);\r\n      this.pikaVolley.gameLoop();\r\n    });\r\n\r\n    this.loader.add(ASSETS_PATH.SPRITE_SHEET);\r\n    for (const prop in ASSETS_PATH.SOUNDS) {\r\n      this.loader.add(ASSETS_PATH.SOUNDS[prop]);\r\n    }\r\n    setUpLoaderProgressBar(this.loader);\r\n\r\n    const reader = new FileReader();\r\n    reader.onload = (event) => {\r\n      let packWithComment;\r\n      let pack;\r\n      try {\r\n        // @ts-ignore\r\n        packWithComment = JSON.parse(event.target.result);\r\n        pack = packWithComment.pack;\r\n        const hash = pack.hash;\r\n        pack.hash = 0;\r\n        if (hash !== getHashCode(serialize(pack))) {\r\n          throw 'Error: The file content is not matching the hash code';\r\n        }\r\n      } catch (err) {\r\n        console.log(err);\r\n        noticeFileOpenError();\r\n        return;\r\n      }\r\n\r\n      const playerActivity = analyzePlayerActivity(pack);\r\n\r\n      const humanPlayerIndex = pack.humanPlayerIndex !== undefined ? pack.humanPlayerIndex : 3;\r\n      let isPlayer1Computer = false;\r\n      let isPlayer2Computer = false;\r\n      if (playerActivity === 1) { isPlayer2Computer = true; }\r\n      else if (playerActivity === 2) { isPlayer1Computer = true; }\r\n      else if (playerActivity === 0) { isPlayer1Computer = true; isPlayer2Computer = true; }\r\n\r\n      if (humanPlayerIndex === 1) { // P1만 사람\r\n        isPlayer2Computer = true;\r\n      } else if (humanPlayerIndex === 2) { // P2만 사람\r\n        isPlayer1Computer = true;\r\n        } else if (humanPlayerIndex === 0) { // 둘 다 AI (또는 판별 불가)\r\n        // 이 경우는 연습 모드처럼 둘 다 컴퓨터로 처리하거나,\r\n        // 아니면 기본값(둘 다 사람 아님)으로 둘 수 있음. 여기선 둘 다 컴퓨터로 가정.\r\n        isPlayer1Computer = true;\r\n        isPlayer2Computer = true;\r\n        } // humanPlayerIndex === 3 (둘 다 사람)이면 기본값(false, false) 유지\r\n      showTotalTimeDuration(getTotalTimeDuration(pack));\r\n      this.loader.load(() => {\r\n        this.pikaVolley = new PikachuVolleyballReplay(\r\n          this.stage,\r\n          this.loader.resources,\r\n          pack.roomID,\r\n          pack.nicknames,\r\n          pack.partialPublicIPs,\r\n          pack.inputs,\r\n          pack.options,\r\n          pack.chats\r\n        );\r\n        // @ts-ignore\r\n        setMaxForScrubberRange(pack.inputs.length);\r\n        this.seekFrame(0);\r\n        this.ticker.start();\r\n        adjustPlayPauseBtnIcon();\r\n        enableReplayScrubberAndBtns();\r\n      });\r\n    };\r\n    try {\r\n      reader.readAsText(file);\r\n    } catch (err) {\r\n      console.log(err);\r\n      noticeFileOpenError();\r\n      return;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Seek the specific frame\r\n   * @param {number} frameNumber\r\n   */\r\n  seekFrame(frameNumber) {\r\n    hideNoticeEndOfReplay();\r\n    this.ticker.stop();\r\n\r\n    // Cleanup previous pikaVolley\r\n    this.pikaVolley.initializeForReplay();\r\n\r\n    if (frameNumber > 0) {\r\n      for (let i = 0; i < frameNumber; i++) {\r\n        this.pikaVolley.gameLoopSilent();\r\n      }\r\n      this.renderer.render(this.stage);\r\n    }\r\n    showTimeCurrent(this.pikaVolley.timeCurrent);\r\n  }\r\n\r\n  /**\r\n   * Seek forward/backward the relative time (seconds).\r\n   * @param {number} seconds plus value for seeking forward, minus value for seeking backward\r\n   */\r\n  seekRelativeTime(seconds) {\r\n    const seekFrameCounter = Math.max(\r\n      0,\r\n      this.pikaVolley.replayFrameCounter + seconds * this.pikaVolley.normalFPS\r\n    );\r\n    this.seekFrame(seekFrameCounter);\r\n  }\r\n\r\n  /**\r\n   * Adjust playback speed by times\r\n   * @param {number} times\r\n   */\r\n  adjustPlaybackSpeedTimes(times) {\r\n    this.playBackSpeedFPS = null;\r\n    this.playBackSpeedTimes = times;\r\n    this.ticker.maxFPS = this.pikaVolley.normalFPS * this.playBackSpeedTimes;\r\n    adjustFPSInputValue();\r\n  }\r\n\r\n  /**\r\n   * Adjust playback speed by fps\r\n   * @param {number} fps\r\n   */\r\n  adjustPlaybackSpeedFPS(fps) {\r\n    this.playBackSpeedTimes = null;\r\n    this.playBackSpeedFPS = fps;\r\n    this.ticker.maxFPS = this.playBackSpeedFPS;\r\n    adjustFPSInputValue();\r\n  }\r\n\r\n  stopBGM() {\r\n    this.pikaVolley.audio.sounds.bgm.center.stop();\r\n  }\r\n\r\n  playBGMProperly() {\r\n    if (this.pikaVolley.isBGMPlaying) {\r\n      this.pikaVolley.audio.sounds.bgm.center.play({\r\n        start: this.pikaVolley.timeBGM,\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nexport const replayPlayer = new ReplayPlayer();\r\n\r\n/**\r\n * Set ticker.maxFPS according to PikachuVolleyball object's normalFPS properly\r\n * @param {number} normalFPS\r\n */\r\nexport function setTickerMaxFPSAccordingToNormalFPS(normalFPS) {\r\n  if (replayPlayer.playBackSpeedFPS) {\r\n    replayPlayer.ticker.maxFPS = replayPlayer.playBackSpeedFPS;\r\n    adjustFPSInputValue();\r\n  } else if (replayPlayer.playBackSpeedTimes) {\r\n    replayPlayer.ticker.maxFPS = normalFPS * replayPlayer.playBackSpeedTimes;\r\n    adjustFPSInputValue();\r\n  }\r\n}\r\n\r\n/**\r\n * Analyzes the replay input data to determine which player(s) moved.\r\n * @param {Object} pack The loaded replay data object containing the 'inputs' array.\r\n * @returns {number} 0: Neither moved / Undetermined, 1: Only P1 moved, 2: Only P2 moved, 3: Both moved\r\n */\r\nfunction analyzePlayerActivity(pack) {\r\n  if (!pack || !pack.inputs || pack.inputs.length === 0) {\r\n    return 0; // 데이터 없으면 판별 불가 \r\n  }\r\n\r\n  let isP1EverMoved = false;\r\n  let isP2EverMoved = false;\r\n  const NO_ACTION_INPUT_5BIT = 0; // \"아무것도 안 함\" 입력값\r\n\r\n  for (const inputNum of pack.inputs) {\r\n    const p1Input5bit = inputNum >>> 5; // P1 입력 추출\r\n    const p2Input5bit = inputNum & 31; // P2 입력 추출 (0b11111 = 31)\r\n\r\n    if (p1Input5bit !== NO_ACTION_INPUT_5BIT) {\r\n      isP1EverMoved = true;\r\n    }\r\n    if (p2Input5bit !== NO_ACTION_INPUT_5BIT) {\r\n      isP2EverMoved = true;\r\n    }\r\n\r\n    // 최적화: 둘 다 움직였으면 더 볼 필요 없음\r\n    if (isP1EverMoved && isP2EverMoved) {\r\n      break;\r\n    }\r\n  }\r\n\r\n  // 결과 반환\r\n  if (isP1EverMoved && !isP2EverMoved) {\r\n    return 1; // P1만 사람 (연습 모드)\r\n  } else if (!isP1EverMoved && isP2EverMoved) {\r\n    return 2; // P2만 사람 (연습 모드)\r\n  } else if (isP1EverMoved && isP2EverMoved) {\r\n    return 3; // 둘 다 사람 (P2P 모드)\r\n  } else {\r\n    return 0; // 둘 다 안 움직임 (판별 불가)\r\n  }\r\n}\r\n\r\n/**\r\n * Set up the loader progress bar.\r\n * @param {Loader} loader\r\n */\r\nfunction setUpLoaderProgressBar(loader) {\r\n  const loadingBox = document.getElementById('loading-box');\r\n  const progressBar = document.getElementById('progress-bar');\r\n\r\n  loader.onProgress.add(() => {\r\n    progressBar.style.width = `${loader.progress}%`;\r\n  });\r\n  loader.onComplete.add(() => {\r\n    loadingBox.classList.add('hidden');\r\n  });\r\n}\r\n\r\n/**\r\n * Get total time duration for the pack\r\n * @param {Object} pack\r\n */\r\nfunction getTotalTimeDuration(pack) {\r\n  const speedChangeRecord = [];\r\n\r\n  let optionsCounter = 0;\r\n  let options = pack.options[optionsCounter];\r\n  while (options) {\r\n    if (options[1].speed) {\r\n      let fpsFromNowOn = null;\r\n      switch (options[1].speed) {\r\n        case 'slow':\r\n          fpsFromNowOn = 20;\r\n          break;\r\n        case 'medium':\r\n          fpsFromNowOn = 25;\r\n          break;\r\n        case 'fast':\r\n          fpsFromNowOn = 30;\r\n          break;\r\n      }\r\n      const frameCounter = options[0];\r\n      speedChangeRecord.push([frameCounter, fpsFromNowOn]);\r\n    }\r\n    optionsCounter++;\r\n    options = pack.options[optionsCounter];\r\n  }\r\n\r\n  let timeDuration = 0; // unit: second\r\n  let currentFrameCounter = 0;\r\n  let currentFPS = 25;\r\n  for (let i = 0; i < speedChangeRecord.length; i++) {\r\n    const futureFrameCounter = speedChangeRecord[i][0];\r\n    const futureFPS = speedChangeRecord[i][1];\r\n    timeDuration += (futureFrameCounter - currentFrameCounter) / currentFPS;\r\n    currentFrameCounter = futureFrameCounter;\r\n    currentFPS = futureFPS;\r\n  }\r\n  timeDuration += (pack.inputs.length - currentFrameCounter) / currentFPS;\r\n\r\n  return timeDuration;\r\n}","import { ASSETS_PATH } from '../assets_path.js';\r\nimport { setUpUI } from './ui_replay.js';\r\n\r\nadjustAssetsPath();\r\nsetUpUI();\r\n\r\n/**\r\n * Adjust game assets path to the path from the perspective of en/replay/index.html\r\n */\r\nfunction adjustAssetsPath() {\r\n  ASSETS_PATH.SPRITE_SHEET = '../' + ASSETS_PATH.SPRITE_SHEET;\r\n  for (const prop in ASSETS_PATH.SOUNDS) {\r\n    ASSETS_PATH.SOUNDS[prop] = '../' + ASSETS_PATH.SOUNDS[prop];\r\n  }\r\n}"],"names":["PikachuVolleyballReplay","_PikachuVolleyball","stage","resources","roomId","nicknames","partialPublicIPs","inputs","options","chats","_this","_classCallCheck","_callSuper","noInputFrameTotal","menu","Infinity","player1Keyboard","xDirection","yDirection","powerHit","getInput","player2Keyboard","keyboardArray","willDisplayChat","fakeSound","play","stop","fakeAudio","sounds","bgm","fake","center","isPlaying","this","pipikachu","pika","chu","pi","pikachu","ballTouchesGround","initializeForReplay","_inherits","key","value","prop","audio","timeCurrent","timeBGM","isBGMPlaying","replayFrameCounter","chatCounter","optionsCounter","customRng","seedrandom","slice","setCustomRng","view","game","cloudArray","i","push","Cloud","wave","Wave","intro","visible","fadeInOut","physics","PikaPhysics","normalFPS","slowMotionFPS","SLOW_MOTION_FRAMES_NUM","slowMotionFramesLeft","slowMotionNumOfSkippedFrames","selectedWithWho","scores","winningScore","gameEnded","roundEnded","isPlayer2Serve","frameCounter","noInputFrameCounter","paused","isStereoSound","_isPracticeMode","isRoomCreatorPlayer2","state","_superPropGet","gameLoop","length","document","getElementById","classList","remove","scrubberRangeInput","usersInputNumber","player1Input","convert5bitNumberToUserInput","player2Input","zKey","rKey","vKey","dKey","gKey","enterKey","upKey","downKey","leftKey","rightKey","pressKeyElm","keyElm","add","unpressKeyElm","showKeyboardInputs","speed","replayPlayer","playBackSpeedFPS","ticker","maxFPS","adjustFPSInputValue","playBackSpeedTimes","chat","PikachuVolleyball","_typeof","o","Symbol","iterator","constructor","prototype","_arrayLikeToArray","r","a","e","n","Array","_defineProperties","t","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","toPrimitive","call","TypeError","String","_toPrimitive","ReplayPlayer","Renderer","registerPlugin","Prepare","BatchRenderer","CanvasRenderer","CanvasPrepare","CanvasSpriteRenderer","Loader","SpritesheetLoader","settings","RESOLUTION","SCALE_MODE","SCALE_MODES","NEAREST","ROUND_PIXELS","Ticker","minFPS","renderer","autoDetectRenderer","width","height","antialias","backgroundColor","backgroundAlpha","forceCanvas","Container","loader","pikaVolley","file","loadingBox","progressBar","TEXTURES","ASSETS_PATH","WITH_COMPUTER","WITH_FRIEND","querySelector","appendChild","render","showTimeCurrent","SPRITE_SHEET","SOUNDS","onProgress","style","concat","progress","onComplete","reader","FileReader","onload","event","packWithComment","pack","timeDuration","JSON","parse","target","result","hash","getHashCode","serialize","err","console","log","noticeFileOpenError","_step","isP1EverMoved","isP2EverMoved","_iterator","isArray","toString","name","from","test","_unsupportedIterableToArray","_n","F","s","done","f","u","next","_createForOfIteratorHelper","inputNum","analyzePlayerActivity","undefined","humanPlayerIndex","speedChangeRecord","fpsFromNowOn","currentFrameCounter","currentFPS","futureFrameCounter","getTotalTimeDuration","textContent","getTimeText","load","max","roomID","seekFrame","start","adjustPlayPauseBtnIcon","disabled","playPauseBtn","seekBackward1Btn","seekForward1Btn","seekBackward3Btn","seekForward3Btn","speedBtn5FPS","speedBtnHalfTimes","speedBtn1Times","speedBtn2Times","readAsText","frameNumber","gameLoopSilent","seconds","seekFrameCounter","Math","times","fps","pausedByBtn","started","time","floor","minutes","hours","adjustAssetsPath","addEventListener","dropbox","handleFiles","files","readFile","processSelected","unselectSpeedBtns","currentTarget","_i","_arr","stopPropagation","preventDefault","dataTransfer","stopBGM","playBGMProperly","targetFrame","Number","seekRelativeTime","adjustPlaybackSpeedFPS","adjustPlaybackSpeedTimes","location","reload","keyboardContainer","showKeyboardCheckbox","checked","showNicknamesCheckbox","player1NicknameElem","player2NicknameElem","showIPsCheckbox","player1IPElem","player2IPElem","turnOnBGMCheckbox","turnBGMVolume","turnOnSFXCheckbox","turnSFXVolume","graphicSharpCheckbox","window","code","click","setUpUI"],"sourceRoot":""}