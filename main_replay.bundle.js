"use strict";(self.webpackChunkpikachu_volleyball=self.webpackChunkpikachu_volleyball||[]).push([[62],{975:(e,t,n)=>{var i=n(591),r=n(603),o=n(787),a=n(592),s=n(650),c=n(449),l=n(561),d=n(49),u=n(401),p=n(77),y=n(697),h=n(505),m=(n(229),n(391)),f=n.n(m),v=n(339),k=n(427),g=n(141),b=n(772),E=n(127);function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function w(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,P(i.key),i)}}function P(e){var t=function(e){if("object"!=S(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=S(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==S(t)?t:t+""}function B(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(B=function(){return!!e})()}function I(e,t,n,i){var r=L(F(1&i?e.prototype:e),t,n);return 2&i&&"function"==typeof r?function(e){return r.apply(n,e)}:r}function L(){return L="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=F(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},L.apply(null,arguments)}function F(e){return F=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},F(e)}function C(e,t){return C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},C(e,t)}var T=function(e){function t(e,n,i,r,o,a,s,c){var l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(l=function(e,t,n){return t=F(t),function(e,t){if(t&&("object"==S(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,B()?Reflect.construct(t,n||[],F(e).constructor):t.apply(e,n))}(this,t,[e,n])).noInputFrameTotal.menu=1/0,l.roomId=i,l.nicknames=r,l.partialPublicIPs=o,l.inputs=a,l.options=s,l.chats=c,l.player1Keyboard={xDirection:0,yDirection:0,powerHit:0,getInput:function(){}},l.player2Keyboard={xDirection:0,yDirection:0,powerHit:0,getInput:function(){}},l.keyboardArray=[l.player1Keyboard,l.player2Keyboard],l.willDisplayChat=!0;var d={play:function(){},stop:function(){}};return l.fakeAudio={sounds:{bgm:{fake:!0,center:{isPlaying:!1},play:function(){this.center.isPlaying=!0},stop:function(){this.center.isPlaying=!1}},pipikachu:d,pika:d,chu:d,pi:d,pikachu:d,powerHit:d,ballTouchesGround:d}},l.initializeForReplay(),l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&C(e,t)}(t,e),n=t,(i=[{key:"initializeForReplay",value:function(){for(var e in this.audio.sounds)this.audio.sounds[e].stop();this.timeCurrent=0,this.timeBGM=0,this.isBGMPlaying=!1,this.replayFrameCounter=0,this.chatCounter=0,this.optionsCounter=0;var t=f().alea(this.roomId.slice(8));(0,k.pe)(t),this.view.game.cloudArray=[];for(var n=0;n<10;n++)this.view.game.cloudArray.push(new g.Es);this.view.game.wave=new g.wH,this.view.intro.visible=!1,this.view.menu.visible=!1,this.view.game.visible=!1,this.view.fadeInOut.visible=!1,this.physics=new b.vW(!0,!0),this.normalFPS=25,this.slowMotionFPS=5,this.SLOW_MOTION_FRAMES_NUM=6,this.slowMotionFramesLeft=0,this.slowMotionNumOfSkippedFrames=0,this.selectedWithWho=0,this.scores=[0,0],this.winningScore=15,this.gameEnded=!1,this.roundEnded=!1,this.isPlayer2Serve=!1,this.frameCounter=0,this.noInputFrameCounter=0,this.paused=!1,this.isStereoSound=!0,this._isPracticeMode=!1,this.isRoomCreatorPlayer2=!1,this.state=this.intro}},{key:"intro",value:function(){0===this.frameCounter&&(this.selectedWithWho=0),I(t,"intro",this,3)([])}},{key:"menu",value:function(){var e=this.selectedWithWho;I(t,"menu",this,3)([]),this.selectedWithWho!==e&&(this.isRoomCreatorPlayer2=!this.isRoomCreatorPlayer2)}},{key:"gameLoopSilent",value:function(){var e=this.audio;this.willDisplayChat=!1,this.audio=this.fakeAudio,this.gameLoop(),this.willDisplayChat=!0,this.audio=e}},{key:"gameLoop",value:function(){if(this.replayFrameCounter>=this.inputs.length)document.getElementById("notice-end-of-replay").classList.remove("hidden");else{var e;e=this.replayFrameCounter,A.value=e;var n=this.inputs[this.replayFrameCounter],i=(0,E.d)(n>>>5),r=(0,E.d)(n%32);this.player1Keyboard.xDirection=i.xDirection,this.player1Keyboard.yDirection=i.yDirection,this.player1Keyboard.powerHit=i.powerHit,this.player2Keyboard.xDirection=r.xDirection,this.player2Keyboard.yDirection=r.yDirection,this.player2Keyboard.powerHit=r.powerHit,function(e,t){var n=document.getElementById("z-key"),i=document.getElementById("r-key"),r=document.getElementById("v-key"),o=document.getElementById("d-key"),a=document.getElementById("g-key"),s=document.getElementById("enter-key"),c=document.getElementById("up-key"),l=document.getElementById("down-key"),d=document.getElementById("left-key"),u=document.getElementById("right-key");function p(e){e.classList.add("pressed")}function y(e){e.classList.remove("pressed")}switch(e.xDirection){case 0:y(o),y(a);break;case-1:p(o),y(a);break;case 1:y(o),p(a)}switch(e.yDirection){case 0:y(i),y(r);break;case-1:p(i),y(r);break;case 1:y(i),p(r)}switch(e.powerHit){case 0:y(n);break;case 1:p(n)}switch(t.xDirection){case 0:y(d),y(u);break;case-1:p(d),y(u);break;case 1:y(d),p(u)}switch(t.yDirection){case 0:y(c),y(l);break;case-1:p(c),y(l);break;case 1:y(c),p(l)}switch(t.powerHit){case 0:y(s);break;case 1:p(s)}}(i,r);for(var o=this.options[this.optionsCounter];o&&o[0]===this.replayFrameCounter;){if(o[1].speed){switch(o[1].speed){case"slow":this.normalFPS=20;break;case"medium":this.normalFPS=25;break;case"fast":this.normalFPS=30}s=this.normalFPS,G.playBackSpeedFPS?(G.ticker.maxFPS=G.playBackSpeedFPS,$()):G.playBackSpeedTimes&&(G.ticker.maxFPS=s*G.playBackSpeedTimes,$())}if(o[1].winningScore)switch(o[1].winningScore){case 5:this.winningScore=5;break;case 10:this.winningScore=10;break;case 15:this.winningScore=15}this.optionsCounter++,o=this.options[this.optionsCounter]}this.timeCurrent+=1/this.normalFPS,this.isBGMPlaying=this.audio.sounds.bgm.center.isPlaying,this.isBGMPlaying?this.timeBGM=(this.timeBGM+1/this.normalFPS)%83:this.timeBGM=0;for(var a=this.chats[this.chatCounter];a&&a[0]===this.replayFrameCounter;)this.chatCounter++,a=this.chats[this.chatCounter];this.replayFrameCounter++,I(t,"gameLoop",this,3)([])}var s}}])&&w(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,i}(v.q),M=n(134),O=n(912);function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function R(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,j(i.key),i)}}function j(e){var t=function(e){if("object"!=x(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=x(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==x(t)?t:t+""}var G=new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a.A4.registerPlugin("prepare",s.p8),a.A4.registerPlugin("batch",a.ch),p.KB.registerPlugin("prepare",h.S),p.KB.registerPlugin("sprite",y.$),l.aH.registerPlugin(d.A),r.W.RESOLUTION=2,r.W.SCALE_MODE=o.M6.NEAREST,r.W.ROUND_PIXELS=!0,this.ticker=new u.Rv,this.ticker.minFPS=1,this.renderer=(0,a.q5)({width:432,height:304,antialias:!1,backgroundColor:0,backgroundAlpha:1,forceCanvas:!0}),this.stage=new c.mc,this.loader=new l.aH,this.pikaVolley=null,this.playBackSpeedTimes=1,this.playBackSpeedFPS=null},(t=[{key:"readFile",value:function(e){var t,n,r,o=this,a=i.I.TEXTURES;for(var s in a.WITH_COMPUTER=a.WITH_FRIEND,document.querySelector("#game-canvas-container").appendChild(this.renderer.view),this.renderer.render(this.stage),this.ticker.add((function(){o.renderer.render(o.stage),Y(o.pikaVolley.timeCurrent),o.pikaVolley.gameLoop()})),this.loader.add(i.I.SPRITE_SHEET),i.I.SOUNDS)this.loader.add(i.I.SOUNDS[s]);t=this.loader,n=document.getElementById("loading-box"),r=document.getElementById("progress-bar"),t.onProgress.add((function(){r.style.width="".concat(t.progress,"%")})),t.onComplete.add((function(){n.classList.add("hidden")}));var c=new FileReader;c.onload=function(e){var t,n,i;try{t=JSON.parse(e.target.result);var r=(n=t.pack).hash;if(n.hash=0,r!==(0,O.i)((0,M.l)(n)))throw"Error: The file content is not matching the hash code"}catch(e){return console.log(e),void Q()}(function(e){if(!e||!e.inputs||0===e.inputs.length)return 0;var t,n=!1,i=!1,r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return D(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(e.inputs);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(o>>>5!=0&&(n=!0),!!(31&o)&&(i=!0),n&&i)break}}catch(e){r.e(e)}finally{r.f()}})(n),void 0!==n.humanPlayerIndex&&n.humanPlayerIndex,i=function(e){for(var t=[],n=0,i=e.options[n];i;){if(i[1].speed){var r=null;switch(i[1].speed){case"slow":r=20;break;case"medium":r=25;break;case"fast":r=30}var o=i[0];t.push([o,r])}n++,i=e.options[n]}for(var a=0,s=0,c=25,l=0;l<t.length;l++){var d=t[l][0];a+=(d-s)/c,s=d,c=t[l][1]}return a+(e.inputs.length-s)/c}(n),document.getElementById("time-duration").textContent=Z(i),o.loader.load((function(){var e;o.pikaVolley=new T(o.stage,o.loader.resources,n.roomID,n.nicknames,n.partialPublicIPs,n.inputs,n.options,n.chats),e=n.inputs.length,A.max=e,o.seekFrame(0),o.ticker.start(),J(),A.disabled=!1,_.disabled=!1,H.disabled=!1,W.disabled=!1,N.disabled=!1,K.disabled=!1,U.disabled=!1,q.disabled=!1,X.disabled=!1,z.disabled=!1}))};try{c.readAsText(e)}catch(e){return console.log(e),void Q()}}},{key:"seekFrame",value:function(e){if(document.getElementById("notice-end-of-replay").classList.add("hidden"),this.ticker.stop(),e>0){for(var t=0;t<e;t++)this.pikaVolley.gameLoopSilent();this.renderer.render(this.stage)}Y(this.pikaVolley.timeCurrent)}},{key:"seekRelativeTime",value:function(e){var t=Math.max(0,this.pikaVolley.replayFrameCounter+e*this.pikaVolley.normalFPS);this.seekFrame(t)}},{key:"adjustPlaybackSpeedTimes",value:function(e){this.playBackSpeedFPS=null,this.playBackSpeedTimes=e,this.ticker.maxFPS=this.pikaVolley.normalFPS*this.playBackSpeedTimes,$()}},{key:"adjustPlaybackSpeedFPS",value:function(e){this.playBackSpeedTimes=null,this.playBackSpeedFPS=e,this.ticker.maxFPS=this.playBackSpeedFPS,$()}},{key:"stopBGM",value:function(){this.pikaVolley.audio.sounds.bgm.center.stop()}},{key:"playBGMProperly",value:function(){this.pikaVolley.isBGMPlaying&&this.pikaVolley.audio.sounds.bgm.center.play({start:this.pikaVolley.timeBGM})}}])&&R(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}());var V=!1,A=document.getElementById("scrubber-range-input"),_=document.getElementById("play-pause-btn"),H=document.getElementById("seek-backward-1"),W=document.getElementById("seek-forward-1"),N=document.getElementById("seek-backward-3"),K=document.getElementById("seek-forward-3"),U=document.getElementById("speed-btn-5-fps"),q=document.getElementById("speed-btn-half-times"),X=document.getElementById("speed-btn-1-times"),z=document.getElementById("speed-btn-2-times");function $(){document.getElementById("fps-input").value=G.ticker.maxFPS}function J(){var e=document.getElementById("play-pause-btn");G.ticker.started?e.textContent=document.getElementById("pause-mark").textContent:e.textContent=document.getElementById("play-mark").textContent}function Q(){document.getElementById("notice-file-open-error").classList.remove("hidden")}function Y(e){document.getElementById("time-current").textContent=Z(e)}function Z(e){var t=Math.floor(e%60),n=Math.floor(e/60)%60,i=Math.floor(Math.floor(e/60)/60);return i>0?"".concat(String(i),":").concat(("0"+n).slice(-2),":").concat(("0"+t).slice(-2)):"".concat(String(n),":").concat(("0"+t).slice(-2))}!function(){for(var e in i.I.SPRITE_SHEET="../"+i.I.SPRITE_SHEET,i.I.SOUNDS)i.I.SOUNDS[e]="../"+i.I.SOUNDS[e]}(),function(){A.disabled=!0,_.disabled=!0,H.disabled=!0,W.disabled=!0,N.disabled=!0,K.disabled=!0,U.disabled=!0,q.disabled=!0,X.disabled=!0,z.disabled=!0,document.getElementById("file-input").addEventListener("change",(function(n){document.getElementById("loading-box").classList.remove("hidden"),e.classList.add("hidden"),t(n.target.files)}));var e=document.getElementById("dropbox");function t(e){G.readFile(e[0])}function n(e){i(),e.currentTarget.classList.add("selected")}function i(){for(var e=0,t=[U,q,X,z];e<t.length;e++)t[e].classList.remove("selected")}e.addEventListener("dragenter",(function(e){e.stopPropagation(),e.preventDefault()}),!1),e.addEventListener("dragover",(function(e){e.stopPropagation(),e.preventDefault()}),!1),e.addEventListener("drop",(function(n){n.stopPropagation(),n.preventDefault();var i=n.dataTransfer.files;document.getElementById("loading-box").classList.remove("hidden"),e.classList.add("hidden"),t(i)}),!1),A.addEventListener("touchstart",(function(){G.ticker.started&&(G.ticker.stop(),G.stopBGM())})),A.addEventListener("mousedown",(function(){G.ticker.started&&(G.ticker.stop(),G.stopBGM())})),A.addEventListener("touchend",(function(){V||G.ticker.started||(G.ticker.start(),G.playBGMProperly())})),A.addEventListener("mouseup",(function(){V||G.ticker.started||(G.ticker.start(),G.playBGMProperly())})),A.addEventListener("change",(function(e){var t=Number(e.currentTarget.value);G.seekFrame(t),V||G.ticker.started||(G.pikaVolley.frameCounter=t,G.ticker.start(),G.playBGMProperly())})),_.disabled=!0,_.addEventListener("click",(function(){G.ticker.started?(G.ticker.stop(),G.stopBGM(),V=!0,J()):(G.ticker.start(),G.playBGMProperly(),V=!1,J())})),H.addEventListener("click",(function(){G.seekRelativeTime(-1),V||G.ticker.started||(G.ticker.start(),G.playBGMProperly())})),W.addEventListener("click",(function(){G.seekRelativeTime(1),V||G.ticker.started||(G.ticker.start(),G.playBGMProperly())})),N.addEventListener("click",(function(){G.seekRelativeTime(-3),V||G.ticker.started||(G.ticker.start(),G.playBGMProperly())})),K.addEventListener("click",(function(){G.seekRelativeTime(3),V||G.ticker.started||(G.ticker.start(),G.playBGMProperly())})),U.addEventListener("click",(function(e){n(e),G.adjustPlaybackSpeedFPS(5)})),q.addEventListener("click",(function(e){n(e),G.adjustPlaybackSpeedTimes(.5)})),X.addEventListener("click",(function(e){n(e),G.adjustPlaybackSpeedTimes(1)})),z.addEventListener("click",(function(e){n(e),G.adjustPlaybackSpeedTimes(2)})),document.getElementById("fps-input").addEventListener("change",(function(e){var t=e.target.value;t<0?t=0:t>60&&(t=60),G.adjustPlaybackSpeedFPS(t),i()})),document.getElementById("notice-end-of-replay-ok-btn").addEventListener("click",(function(){location.reload()})),document.getElementById("notice-file-open-error-ok-btn").addEventListener("click",(function(){location.reload()}));var r=document.getElementById("keyboard-container"),o=document.getElementById("show-keyboard-checkbox");o.addEventListener("change",(function(){o.checked?r.classList.remove("hidden"):r.classList.add("hidden")}));var a=document.getElementById("show-nicknames-checkbox"),s=document.getElementById("player1-nickname"),c=document.getElementById("player2-nickname");a.addEventListener("change",(function(){a.checked?(s.classList.remove("hidden"),c.classList.remove("hidden")):(s.classList.add("hidden"),c.classList.add("hidden"))}));var l=document.getElementById("show-ip-addresses-checkbox"),d=document.getElementById("player1-partial-ip"),u=document.getElementById("player2-partial-ip");l.addEventListener("change",(function(){l.checked?(d.classList.remove("hidden"),u.classList.remove("hidden")):(d.classList.add("hidden"),u.classList.add("hidden"))}));var p=document.getElementById("turn-on-bgm-checkbox");p.addEventListener("change",(function(){null!==G.pikaVolley&&(p.checked?G.pikaVolley.audio.turnBGMVolume(!0):G.pikaVolley.audio.turnBGMVolume(!1))}));var y=document.getElementById("turn-on-sfx-checkbox");y.addEventListener("change",(function(){null!==G.pikaVolley&&(y.checked?G.pikaVolley.audio.turnSFXVolume(!0):G.pikaVolley.audio.turnSFXVolume(!1))}));var h=document.getElementById("graphic-sharp-checkbox");h.addEventListener("change",(function(){null!==G.pikaVolley&&(h.checked?document.querySelector("#game-canvas-container>canvas").classList.remove("graphic-soft"):document.querySelector("#game-canvas-container>canvas").classList.add("graphic-soft"))})),window.addEventListener("keydown",(function(e){"Space"===e.code?(e.preventDefault(),_.click()):"ArrowLeft"===e.code?(e.preventDefault(),N.click()):"ArrowRight"===e.code&&(e.preventDefault(),K.click())}))}()}},e=>{e.O(0,[965,396],(()=>e(e.s=975))),e.O()}]);
//# sourceMappingURL=main_replay.bundle.js.map