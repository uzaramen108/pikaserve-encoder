(self.webpackChunkpikachu_volleyball=self.webpackChunkpikachu_volleyball||[]).push([[62],{234:()=>{},942:(e,t,i)=>{"use strict";var s=i(17),n=i(603),a=i(787),r=i(284),o=i(650),d=i(449),l=i(561),c=i(49),h=i(401),p=i(77),u=i(697),m=i(505),y=(i(229),i(391)),k=i.n(y),g=i(579),b=i(489),E=i(351),S=i(773),f=i(805);class v extends g.q{constructor(e,t,i,s,n,a,r,o,d,l){super(e,t),this.noInputFrameTotal.menu=1/0,this.roomId=i,this.nicknames=s,this.partialPublicIPs=n,this.inputs=a,this.options=r,this.chats=o,this.player1Keyboard={xDirection:0,yDirection:0,powerHit:0,getInput:()=>{}},this.player2Keyboard={xDirection:0,yDirection:0,powerHit:0,getInput:()=>{}},this.keyboardArray=[this.player1Keyboard,this.player2Keyboard],this.willDisplayChat=!0;const c={play:()=>{},stop:()=>{}};this.fakeAudio={sounds:{bgm:{fake:!0,center:{isPlaying:!1},play:function(){this.center.isPlaying=!0},stop:function(){this.center.isPlaying=!1}},pipikachu:c,pika:c,chu:c,pi:c,pikachu:c,powerHit:c,ballTouchesGround:c}},this.initializeForReplay()}initializeForReplay(){for(const e in this.audio.sounds)this.audio.sounds[e].stop();this.timeCurrent=0,this.timeBGM=0,this.isBGMPlaying=!1,this.replayFrameCounter=0,this.chatCounter=0,this.optionsCounter=0;const e=k().alea(this.roomId.slice(10));(0,b.p)(e),k().alea(this.roomId.slice(10,15)),k().alea(this.roomId.slice(15)),this.view.game.cloudArray=[];for(let e=0;e<10;e++)this.view.game.cloudArray.push(new E.Es);this.view.game.wave=new E.wH,this.view.intro.visible=!1,this.view.menu.visible=!1,this.view.game.visible=!1,this.view.fadeInOut.visible=!1,this.physics=new S.vW(!0,!0),this.normalFPS=25,this.slowMotionFPS=5,this.SLOW_MOTION_FRAMES_NUM=6,this.slowMotionFramesLeft=0,this.slowMotionNumOfSkippedFrames=0,this.selectedWithWho=0,this.scores=[0,0],this.winningScore=15,this.gameEnded=!1,this.roundEnded=!1,this.isPlayer2Serve=!1,this.frameCounter=0,this.noInputFrameCounter=0,this.paused=!1,this.isStereoSound=!0,this._isPracticeMode=!1,this.isRoomCreatorPlayer2=!1,this.state=this.intro}intro(){0===this.frameCounter&&(this.selectedWithWho=0),super.intro()}menu(){const e=this.selectedWithWho;super.menu(),this.selectedWithWho!==e&&(this.isRoomCreatorPlayer2=!this.isRoomCreatorPlayer2)}gameLoopSilent(){const e=this.audio;this.willDisplayChat=!1,this.audio=this.fakeAudio,this.gameLoop(),this.willDisplayChat=!0,this.audio=e}gameLoop(){if(this.replayFrameCounter>=this.inputs.length)return void document.getElementById("notice-end-of-replay").classList.remove("hidden");var e;e=this.replayFrameCounter,L.value=e;const t=this.inputs[this.replayFrameCounter],i=(0,f.d)(t>>>5),s=(0,f.d)(t%32);this.player1Keyboard.xDirection=i.xDirection,this.player1Keyboard.yDirection=i.yDirection,this.player1Keyboard.powerHit=i.powerHit,this.player2Keyboard.xDirection=s.xDirection,this.player2Keyboard.yDirection=s.yDirection,this.player2Keyboard.powerHit=s.powerHit,function(e,t){const i=document.getElementById("z-key"),s=document.getElementById("r-key"),n=document.getElementById("v-key"),a=document.getElementById("d-key"),r=document.getElementById("g-key"),o=document.getElementById("enter-key"),d=document.getElementById("up-key"),l=document.getElementById("down-key"),c=document.getElementById("left-key"),h=document.getElementById("right-key");function p(e){e.classList.add("pressed")}function u(e){e.classList.remove("pressed")}switch(e.xDirection){case 0:u(a),u(r);break;case-1:p(a),u(r);break;case 1:u(a),p(r)}switch(e.yDirection){case 0:u(s),u(n);break;case-1:p(s),u(n);break;case 1:u(s),p(n)}switch(e.powerHit){case 0:u(i);break;case 1:p(i)}switch(t.xDirection){case 0:u(c),u(h);break;case-1:p(c),u(h);break;case 1:u(c),p(h)}switch(t.yDirection){case 0:u(d),u(l);break;case-1:p(d),u(l);break;case 1:u(d),p(l)}switch(t.powerHit){case 0:u(o);break;case 1:p(o)}}(i,s);let n=this.options[this.optionsCounter];for(;n&&n[0]===this.replayFrameCounter;){if(n[1].speed){switch(n[1].speed){case"slow":this.normalFPS=20;break;case"medium":this.normalFPS=25;break;case"fast":this.normalFPS=30}a=this.normalFPS,P.playBackSpeedFPS?(P.ticker.maxFPS=P.playBackSpeedFPS,O()):P.playBackSpeedTimes&&(P.ticker.maxFPS=a*P.playBackSpeedTimes,O())}if(n[1].winningScore)switch(n[1].winningScore){case 5:this.winningScore=5;break;case 10:this.winningScore=10;break;case 15:this.winningScore=15}this.optionsCounter++,n=this.options[this.optionsCounter]}var a;this.timeCurrent+=1/this.normalFPS,this.isBGMPlaying=this.audio.sounds.bgm.center.isPlaying,this.isBGMPlaying?this.timeBGM=(this.timeBGM+1/this.normalFPS)%83:this.timeBGM=0;let r=this.chats[this.chatCounter];for(;r&&r[0]===this.replayFrameCounter;)this.chatCounter++,r=this.chats[this.chatCounter];this.replayFrameCounter++,super.gameLoop()}}var B=i(212),I=i(970);const P=new class{constructor(){r.A4.registerPlugin("prepare",o.p8),r.A4.registerPlugin("batch",r.ch),p.KB.registerPlugin("prepare",m.S),p.KB.registerPlugin("sprite",u.$),l.aH.registerPlugin(c.A),n.W.RESOLUTION=2,n.W.SCALE_MODE=a.M6.NEAREST,n.W.ROUND_PIXELS=!0,this.ticker=new h.Rv,this.ticker.minFPS=1,this.renderer=(0,r.q5)({width:432,height:304,antialias:!1,backgroundColor:0,backgroundAlpha:1,forceCanvas:!0}),this.stage=new d.mc,this.loader=new l.aH,this.pikaVolley=null,this.playBackSpeedTimes=1,this.playBackSpeedFPS=null}readFile(e){const t=s.I.TEXTURES;t.WITH_COMPUTER=t.WITH_FRIEND,document.querySelector("#game-canvas-container").appendChild(this.renderer.view),this.renderer.render(this.stage),this.ticker.add((()=>{this.renderer.render(this.stage),W(this.pikaVolley.timeCurrent),this.pikaVolley.gameLoop()})),this.loader.add(s.I.SPRITE_SHEET);for(const e in s.I.SOUNDS)this.loader.add(s.I.SOUNDS[e]);!function(e){const t=document.getElementById("loading-box"),i=document.getElementById("progress-bar");e.onProgress.add((()=>{i.style.width=`${e.progress}%`})),e.onComplete.add((()=>{t.classList.add("hidden")}))}(this.loader);const i=new FileReader;i.onload=e=>{let t,i;try{t=JSON.parse(e.target.result),i=t.pack;const s=i.hash;if(i.hash=0,s!==(0,I.i)((0,B.l)(i)))throw"Error: The file content is not matching the hash code"}catch(e){return console.log(e),void A()}const s=function(e){if(!e||!e.inputs||0===e.inputs.length)return 0;let t=!1,i=!1;for(const s of e.inputs)if(s>>>5!=0&&(t=!0),!!(31&s)&&(i=!0),t&&i)break;return t&&!i?1:!t&&i?2:t&&i?3:0}(i),n=void 0!==i.humanPlayerIndex?i.humanPlayerIndex:3;let a=!1,r=!1;var o;1===s?r=!0:2===s?a=!0:0===s&&(a=!0,r=!0),1===n?r=!0:2===n?a=!0:0===n&&(a=!0,r=!0),o=function(e){const t=[];let i=0,s=e.options[i];for(;s;){if(s[1].speed){let e=null;switch(s[1].speed){case"slow":e=20;break;case"medium":e=25;break;case"fast":e=30}const i=s[0];t.push([i,e])}i++,s=e.options[i]}let n=0,a=0,r=25;for(let e=0;e<t.length;e++){const i=t[e][0];n+=(i-a)/r,a=i,r=t[e][1]}return n+=(e.inputs.length-a)/r,n}(i),document.getElementById("time-duration").textContent=N(o),this.loader.load((()=>{var e;this.pikaVolley=new v(this.stage,this.loader.resources,i.roomID,i.nicknames,i.partialPublicIPs,i.inputs,i.options,i.chats,a,r),e=i.inputs.length,L.max=e,this.seekFrame(0),this.ticker.start(),H(),L.disabled=!1,F.disabled=!1,C.disabled=!1,M.disabled=!1,T.disabled=!1,x.disabled=!1,D.disabled=!1,V.disabled=!1,G.disabled=!1,R.disabled=!1}))};try{i.readAsText(e)}catch(e){return console.log(e),void A()}}seekFrame(e){if(document.getElementById("notice-end-of-replay").classList.add("hidden"),this.ticker.stop(),this.pikaVolley.initializeForReplay(),e>0){for(let t=0;t<e;t++)this.pikaVolley.gameLoopSilent();this.renderer.render(this.stage)}W(this.pikaVolley.timeCurrent)}seekRelativeTime(e){const t=Math.max(0,this.pikaVolley.replayFrameCounter+e*this.pikaVolley.normalFPS);this.seekFrame(t)}adjustPlaybackSpeedTimes(e){this.playBackSpeedFPS=null,this.playBackSpeedTimes=e,this.ticker.maxFPS=this.pikaVolley.normalFPS*this.playBackSpeedTimes,O()}adjustPlaybackSpeedFPS(e){this.playBackSpeedTimes=null,this.playBackSpeedFPS=e,this.ticker.maxFPS=this.playBackSpeedFPS,O()}stopBGM(){this.pikaVolley.audio.sounds.bgm.center.stop()}playBGMProperly(){this.pikaVolley.isBGMPlaying&&this.pikaVolley.audio.sounds.bgm.center.play({start:this.pikaVolley.timeBGM})}};let w=!1;const L=document.getElementById("scrubber-range-input"),F=document.getElementById("play-pause-btn"),C=document.getElementById("seek-backward-1"),M=document.getElementById("seek-forward-1"),T=document.getElementById("seek-backward-3"),x=document.getElementById("seek-forward-3"),D=document.getElementById("speed-btn-5-fps"),V=document.getElementById("speed-btn-half-times"),G=document.getElementById("speed-btn-1-times"),R=document.getElementById("speed-btn-2-times");function O(){document.getElementById("fps-input").value=P.ticker.maxFPS}function H(){const e=document.getElementById("play-pause-btn");P.ticker.started?e.textContent=document.getElementById("pause-mark").textContent:e.textContent=document.getElementById("play-mark").textContent}function A(){document.getElementById("notice-file-open-error").classList.remove("hidden")}function W(e){document.getElementById("time-current").textContent=N(e)}function N(e){const t=Math.floor(e%60),i=Math.floor(e/60)%60,s=Math.floor(Math.floor(e/60)/60);return s>0?`${String(s)}:${("0"+i).slice(-2)}:${("0"+t).slice(-2)}`:`${String(i)}:${("0"+t).slice(-2)}`}!function(){s.I.SPRITE_SHEET="../"+s.I.SPRITE_SHEET;for(const e in s.I.SOUNDS)s.I.SOUNDS[e]="../"+s.I.SOUNDS[e]}(),function(){L.disabled=!0,F.disabled=!0,C.disabled=!0,M.disabled=!0,T.disabled=!0,x.disabled=!0,D.disabled=!0,V.disabled=!0,G.disabled=!0,R.disabled=!0,document.getElementById("file-input").addEventListener("change",(i=>{document.getElementById("loading-box").classList.remove("hidden"),e.classList.add("hidden"),t(i.target.files)}));const e=document.getElementById("dropbox");function t(e){P.readFile(e[0])}function i(e){s(),e.currentTarget.classList.add("selected")}function s(){for(const e of[D,V,G,R])e.classList.remove("selected")}e.addEventListener("dragenter",(function(e){e.stopPropagation(),e.preventDefault()}),!1),e.addEventListener("dragover",(function(e){e.stopPropagation(),e.preventDefault()}),!1),e.addEventListener("drop",(function(i){i.stopPropagation(),i.preventDefault();const s=i.dataTransfer.files;document.getElementById("loading-box").classList.remove("hidden"),e.classList.add("hidden"),t(s)}),!1),L.addEventListener("touchstart",(()=>{P.ticker.started&&(P.ticker.stop(),P.stopBGM())})),L.addEventListener("mousedown",(()=>{P.ticker.started&&(P.ticker.stop(),P.stopBGM())})),L.addEventListener("touchend",(()=>{w||P.ticker.started||(P.ticker.start(),P.playBGMProperly())})),L.addEventListener("mouseup",(()=>{w||P.ticker.started||(P.ticker.start(),P.playBGMProperly())})),L.addEventListener("input",(e=>{P.seekFrame(Number(e.currentTarget.value))})),F.disabled=!0,F.addEventListener("click",(()=>{console.log("pp buttonpressed"),P.ticker.started?(P.ticker.stop(),P.stopBGM(),w=!0,H()):(P.ticker.start(),P.playBGMProperly(),w=!1,H())})),C.addEventListener("click",(()=>{P.seekRelativeTime(-1),w||P.ticker.started||(P.ticker.start(),P.playBGMProperly())})),M.addEventListener("click",(()=>{P.seekRelativeTime(1),w||P.ticker.started||(P.ticker.start(),P.playBGMProperly())})),T.addEventListener("click",(()=>{P.seekRelativeTime(-3),w||P.ticker.started||(P.ticker.start(),P.playBGMProperly())})),x.addEventListener("click",(()=>{P.seekRelativeTime(3),w||P.ticker.started||(P.ticker.start(),P.playBGMProperly())})),D.addEventListener("click",(e=>{i(e),P.adjustPlaybackSpeedFPS(5)})),V.addEventListener("click",(e=>{i(e),P.adjustPlaybackSpeedTimes(.5)})),G.addEventListener("click",(e=>{i(e),P.adjustPlaybackSpeedTimes(1)})),R.addEventListener("click",(e=>{i(e),P.adjustPlaybackSpeedTimes(2)})),document.getElementById("fps-input").addEventListener("change",(e=>{let t=e.target.value;t<0?t=0:t>60&&(t=60),P.adjustPlaybackSpeedFPS(t),s()})),document.getElementById("notice-end-of-replay-ok-btn").addEventListener("click",(()=>{location.reload()})),document.getElementById("notice-file-open-error-ok-btn").addEventListener("click",(()=>{location.reload()}));const n=document.getElementById("keyboard-container"),a=document.getElementById("show-keyboard-checkbox");a.addEventListener("change",(()=>{a.checked?n.classList.remove("hidden"):n.classList.add("hidden")}));const r=document.getElementById("turn-on-bgm-checkbox");r.addEventListener("change",(()=>{null!==P.pikaVolley&&(r.checked?P.pikaVolley.audio.turnBGMVolume(!0):P.pikaVolley.audio.turnBGMVolume(!1))}));const o=document.getElementById("turn-on-sfx-checkbox");o.addEventListener("change",(()=>{null!==P.pikaVolley&&(o.checked?P.pikaVolley.audio.turnSFXVolume(!0):P.pikaVolley.audio.turnSFXVolume(!1))}));const d=document.getElementById("graphic-sharp-checkbox");d.addEventListener("change",(()=>{null!==P.pikaVolley&&(d.checked?document.querySelector("#game-canvas-container>canvas").classList.remove("graphic-soft"):document.querySelector("#game-canvas-container>canvas").classList.add("graphic-soft"))})),window.addEventListener("keydown",(e=>{"Space"===e.code?(e.preventDefault(),F.click()):"ArrowLeft"===e.code?(e.preventDefault(),T.click()):"ArrowRight"===e.code&&(e.preventDefault(),x.click())}))}()}},e=>{e.O(0,[663,391,579],(()=>e(e.s=942))),e.O()}]);
//# sourceMappingURL=main_replay.bundle.js.map