(self.webpackChunkpikachu_volleyball=self.webpackChunkpikachu_volleyball||[]).push([[62],{234:()=>{},942:(e,t,i)=>{"use strict";var s=i(17),a=i(603),n=i(787),r=i(284),o=i(650),l=i(449),d=i(561),c=i(49),h=i(401),p=i(77),u=i(697),y=i(505),m=(i(229),i(391)),k=i.n(m),g=i(579),b=i(489),E=i(351),S=(i(773),i(805));class v extends g.q{constructor(e,t,i,s,a,n,r,o,l,d,c){super(e,t),this.noInputFrameTotal.menu=1/0,this.roomId=i,this.nicknames=s,this.partialPublicIPs=a,this.inputs=n,this.options=r,this.chats=o,this.initialBallStates=l||[[0,{x:56,y:0}]],this.physics&&this.physics.player1&&this.physics.player2?(this.physics.player1.isComputer=d,this.physics.player2.isComputer=c):console.error("PikaPhysics object not created correctly by super()!"),this.player1Keyboard={xDirection:0,yDirection:0,powerHit:0,getInput:()=>{}},this.player2Keyboard={xDirection:0,yDirection:0,powerHit:0,getInput:()=>{}},this.keyboardArray=[this.player1Keyboard,this.player2Keyboard],this.willDisplayChat=!0,this.initializeForReplay();const h={play:()=>{},stop:()=>{}};this.fakeAudio={sounds:{bgm:{fake:!0,center:{isPlaying:!1},play:function(){this.center.isPlaying=!0},stop:function(){this.center.isPlaying=!1}},pipikachu:h,pika:h,chu:h,pi:h,pikachu:h,powerHit:h,ballTouchesGround:h}},this.initializeForReplay()}initializeForReplay(){for(const e in this.audio.sounds)this.audio.sounds[e].stop();this.timeCurrent=0,this.timeBGM=0,this.isBGMPlaying=!1,this.replayFrameCounter=0,this.chatCounter=0,this.optionsCounter=0;const e=k().alea(this.roomId.slice(10));(0,b.p)(e),k().alea(this.roomId.slice(10,15)),k().alea(this.roomId.slice(15)),this.initialBallStates[0],this.view.game.cloudArray=[];for(let e=0;e<10;e++)this.view.game.cloudArray.push(new E.Es);this.view.game.wave=new E.wH,this.view.intro.visible=!1,this.view.menu.visible=!1,this.view.game.visible=!1,this.view.fadeInOut.visible=!1,this.physics.player1.initializeForNewRound(),this.physics.player2.initializeForNewRound();const t=this.initialBallStates.find((e=>0===e[0]));t?(this.physics.ball.x=t[1].x,this.physics.ball.y=t[1].y,this.physics.ball.xVelocity=0,this.physics.ball.yVelocity=1):this.physics.ball.initializeForNewRound(!1),this.normalFPS=25,this.slowMotionFPS=5,this.SLOW_MOTION_FRAMES_NUM=6,this.slowMotionFramesLeft=0,this.slowMotionNumOfSkippedFrames=0,this.selectedWithWho=0,this.scores=[0,0],this.winningScore=15,this.gameEnded=!1,this.roundEnded=!1,this.isPlayer2Serve=!1,this.frameCounter=0,this.noInputFrameCounter=0,this.paused=!1,this.isStereoSound=!0,this._isPracticeMode=!1,this.isRoomCreatorPlayer2=!1,this.state=this.intro}intro(){0===this.frameCounter&&(this.selectedWithWho=0),super.intro()}menu(){const e=this.selectedWithWho;super.menu(),this.selectedWithWho!==e&&(this.isRoomCreatorPlayer2=!this.isRoomCreatorPlayer2)}gameLoopSilent(){const e=this.audio;this.willDisplayChat=!1,this.audio=this.fakeAudio,this.gameLoop(),this.willDisplayChat=!0,this.audio=e}gameLoop(){if(this.replayFrameCounter>=this.inputs.length)return void document.getElementById("notice-end-of-replay").classList.remove("hidden");var e;e=this.replayFrameCounter,w.value=e;const t=this.inputs[this.replayFrameCounter],i=(0,S.d)(t>>>5),s=(0,S.d)(t%32);this.player1Keyboard.xDirection=i.xDirection,this.player1Keyboard.yDirection=i.yDirection,this.player1Keyboard.powerHit=i.powerHit,this.player2Keyboard.xDirection=s.xDirection,this.player2Keyboard.yDirection=s.yDirection,this.player2Keyboard.powerHit=s.powerHit,function(e,t){const i=document.getElementById("z-key"),s=document.getElementById("r-key"),a=document.getElementById("v-key"),n=document.getElementById("d-key"),r=document.getElementById("g-key"),o=document.getElementById("enter-key"),l=document.getElementById("up-key"),d=document.getElementById("down-key"),c=document.getElementById("left-key"),h=document.getElementById("right-key");function p(e){e.classList.add("pressed")}function u(e){e.classList.remove("pressed")}switch(e.xDirection){case 0:u(n),u(r);break;case-1:p(n),u(r);break;case 1:u(n),p(r)}switch(e.yDirection){case 0:u(s),u(a);break;case-1:p(s),u(a);break;case 1:u(s),p(a)}switch(e.powerHit){case 0:u(i);break;case 1:p(i)}switch(t.xDirection){case 0:u(c),u(h);break;case-1:p(c),u(h);break;case 1:u(c),p(h)}switch(t.yDirection){case 0:u(l),u(d);break;case-1:p(l),u(d);break;case 1:u(l),p(d)}switch(t.powerHit){case 0:u(o);break;case 1:p(o)}}(i,s);let a=this.options[this.optionsCounter];for(;a&&a[0]===this.replayFrameCounter;){if(a[1].speed){switch(a[1].speed){case"slow":this.normalFPS=20;break;case"medium":this.normalFPS=25;break;case"fast":this.normalFPS=30}n=this.normalFPS,I.playBackSpeedFPS?(I.ticker.maxFPS=I.playBackSpeedFPS,G()):I.playBackSpeedTimes&&(I.ticker.maxFPS=n*I.playBackSpeedTimes,G())}if(a[1].winningScore)switch(a[1].winningScore){case 5:this.winningScore=5;break;case 10:this.winningScore=10;break;case 15:this.winningScore=15}this.optionsCounter++,a=this.options[this.optionsCounter]}var n;this.timeCurrent+=1/this.normalFPS,this.isBGMPlaying=this.audio.sounds.bgm.center.isPlaying,this.isBGMPlaying?this.timeBGM=(this.timeBGM+1/this.normalFPS)%83:this.timeBGM=0;let r=this.chats[this.chatCounter];for(;r&&r[0]===this.replayFrameCounter;)this.chatCounter++,r=this.chats[this.chatCounter];this.replayFrameCounter++,this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!1,super.gameLoop()}}var B=i(212),f=i(970);const I=new class{constructor(){r.A4.registerPlugin("prepare",o.p8),r.A4.registerPlugin("batch",r.ch),p.KB.registerPlugin("prepare",y.S),p.KB.registerPlugin("sprite",u.$),d.aH.registerPlugin(c.A),a.W.RESOLUTION=2,a.W.SCALE_MODE=n.M6.NEAREST,a.W.ROUND_PIXELS=!0,this.ticker=new h.Rv,this.ticker.minFPS=1,this.renderer=(0,r.q5)({width:432,height:304,antialias:!1,backgroundColor:0,backgroundAlpha:1,forceCanvas:!0}),this.stage=new l.mc,this.loader=new d.aH,this.pikaVolley=null,this.playBackSpeedTimes=1,this.playBackSpeedFPS=null}readFile(e){const t=s.I.TEXTURES;t.WITH_COMPUTER=t.WITH_FRIEND,document.querySelector("#game-canvas-container").appendChild(this.renderer.view),this.renderer.render(this.stage),this.ticker.add((()=>{this.renderer.render(this.stage),N(this.pikaVolley.timeCurrent),this.pikaVolley.gameLoop()})),this.loader.add(s.I.SPRITE_SHEET);for(const e in s.I.SOUNDS)this.loader.add(s.I.SOUNDS[e]);!function(e){const t=document.getElementById("loading-box"),i=document.getElementById("progress-bar");e.onProgress.add((()=>{i.style.width=`${e.progress}%`})),e.onComplete.add((()=>{t.classList.add("hidden")}))}(this.loader);const i=new FileReader;i.onload=e=>{let t,i;try{t=JSON.parse(e.target.result),i=t.pack;const s=i.hash;if(i.hash=0,s!==(0,f.i)((0,B.l)(i)))throw"Error: The file content is not matching the hash code"}catch(e){return console.log(e),void H()}const s=void 0!==i.humanPlayerIndex?i.humanPlayerIndex:3;let a=!1,n=!1;var r;1===s?n=!0:2===s?a=!0:0===s&&(a=!0,n=!0),r=function(e){const t=[];let i=0,s=e.options[i];for(;s;){if(s[1].speed){let e=null;switch(s[1].speed){case"slow":e=20;break;case"medium":e=25;break;case"fast":e=30}const i=s[0];t.push([i,e])}i++,s=e.options[i]}let a=0,n=0,r=25;for(let e=0;e<t.length;e++){const i=t[e][0];a+=(i-n)/r,n=i,r=t[e][1]}return a+=(e.inputs.length-n)/r,a}(i),document.getElementById("time-duration").textContent=A(r),this.loader.load((()=>{var e;this.pikaVolley=new v(this.stage,this.loader.resources,i.roomID,i.nicknames,i.partialPublicIPs,i.inputs,i.options,i.chats,i.initialBallStates,a,n),e=i.inputs.length,w.max=e,this.seekFrame(0),this.ticker.start(),O(),w.disabled=!1,F.disabled=!1,L.disabled=!1,C.disabled=!1,x.disabled=!1,M.disabled=!1,T.disabled=!1,D.disabled=!1,R.disabled=!1,V.disabled=!1}))};try{i.readAsText(e)}catch(e){return console.log(e),void H()}}seekFrame(e){if(document.getElementById("notice-end-of-replay").classList.add("hidden"),this.ticker.stop(),this.pikaVolley.initializeForReplay(),e>0){for(let t=0;t<e;t++)this.pikaVolley.gameLoopSilent();this.renderer.render(this.stage)}N(this.pikaVolley.timeCurrent)}seekRelativeTime(e){const t=Math.max(0,this.pikaVolley.replayFrameCounter+e*this.pikaVolley.normalFPS);this.seekFrame(t)}adjustPlaybackSpeedTimes(e){this.playBackSpeedFPS=null,this.playBackSpeedTimes=e,this.ticker.maxFPS=this.pikaVolley.normalFPS*this.playBackSpeedTimes,G()}adjustPlaybackSpeedFPS(e){this.playBackSpeedTimes=null,this.playBackSpeedFPS=e,this.ticker.maxFPS=this.playBackSpeedFPS,G()}stopBGM(){this.pikaVolley.audio.sounds.bgm.center.stop()}playBGMProperly(){this.pikaVolley.isBGMPlaying&&this.pikaVolley.audio.sounds.bgm.center.play({start:this.pikaVolley.timeBGM})}};let P=!1;const w=document.getElementById("scrubber-range-input"),F=document.getElementById("play-pause-btn"),L=document.getElementById("seek-backward-1"),C=document.getElementById("seek-forward-1"),x=document.getElementById("seek-backward-3"),M=document.getElementById("seek-forward-3"),T=document.getElementById("speed-btn-5-fps"),D=document.getElementById("speed-btn-half-times"),R=document.getElementById("speed-btn-1-times"),V=document.getElementById("speed-btn-2-times");function G(){document.getElementById("fps-input").value=I.ticker.maxFPS}function O(){const e=document.getElementById("play-pause-btn");I.ticker.started?e.textContent=document.getElementById("pause-mark").textContent:e.textContent=document.getElementById("play-mark").textContent}function H(){document.getElementById("notice-file-open-error").classList.remove("hidden")}function N(e){document.getElementById("time-current").textContent=A(e)}function A(e){const t=Math.floor(e%60),i=Math.floor(e/60)%60,s=Math.floor(Math.floor(e/60)/60);return s>0?`${String(s)}:${("0"+i).slice(-2)}:${("0"+t).slice(-2)}`:`${String(i)}:${("0"+t).slice(-2)}`}!function(){s.I.SPRITE_SHEET="../"+s.I.SPRITE_SHEET;for(const e in s.I.SOUNDS)s.I.SOUNDS[e]="../"+s.I.SOUNDS[e]}(),function(){w.disabled=!0,F.disabled=!0,L.disabled=!0,C.disabled=!0,x.disabled=!0,M.disabled=!0,T.disabled=!0,D.disabled=!0,R.disabled=!0,V.disabled=!0,document.getElementById("file-input").addEventListener("change",(i=>{document.getElementById("loading-box").classList.remove("hidden"),e.classList.add("hidden"),t(i.target.files)}));const e=document.getElementById("dropbox");function t(e){I.readFile(e[0])}function i(e){s(),e.currentTarget.classList.add("selected")}function s(){for(const e of[T,D,R,V])e.classList.remove("selected")}e.addEventListener("dragenter",(function(e){e.stopPropagation(),e.preventDefault()}),!1),e.addEventListener("dragover",(function(e){e.stopPropagation(),e.preventDefault()}),!1),e.addEventListener("drop",(function(i){i.stopPropagation(),i.preventDefault();const s=i.dataTransfer.files;document.getElementById("loading-box").classList.remove("hidden"),e.classList.add("hidden"),t(s)}),!1),w.addEventListener("touchstart",(()=>{I.ticker.started&&(I.ticker.stop(),I.stopBGM())})),w.addEventListener("mousedown",(()=>{I.ticker.started&&(I.ticker.stop(),I.stopBGM())})),w.addEventListener("touchend",(()=>{P||I.ticker.started||(I.ticker.start(),I.playBGMProperly())})),w.addEventListener("mouseup",(()=>{P||I.ticker.started||(I.ticker.start(),I.playBGMProperly())})),w.addEventListener("input",(e=>{I.seekFrame(Number(e.currentTarget.value))})),F.disabled=!0,F.addEventListener("click",(()=>{console.log("pp buttonpressed"),I.ticker.started?(I.ticker.stop(),I.stopBGM(),P=!0,O()):(I.ticker.start(),I.playBGMProperly(),P=!1,O())})),L.addEventListener("click",(()=>{I.seekRelativeTime(-1),P||I.ticker.started||(I.ticker.start(),I.playBGMProperly())})),C.addEventListener("click",(()=>{I.seekRelativeTime(1),P||I.ticker.started||(I.ticker.start(),I.playBGMProperly())})),x.addEventListener("click",(()=>{I.seekRelativeTime(-3),P||I.ticker.started||(I.ticker.start(),I.playBGMProperly())})),M.addEventListener("click",(()=>{I.seekRelativeTime(3),P||I.ticker.started||(I.ticker.start(),I.playBGMProperly())})),T.addEventListener("click",(e=>{i(e),I.adjustPlaybackSpeedFPS(5)})),D.addEventListener("click",(e=>{i(e),I.adjustPlaybackSpeedTimes(.5)})),R.addEventListener("click",(e=>{i(e),I.adjustPlaybackSpeedTimes(1)})),V.addEventListener("click",(e=>{i(e),I.adjustPlaybackSpeedTimes(2)})),document.getElementById("fps-input").addEventListener("change",(e=>{let t=e.target.value;t<0?t=0:t>60&&(t=60),I.adjustPlaybackSpeedFPS(t),s()})),document.getElementById("notice-end-of-replay-ok-btn").addEventListener("click",(()=>{location.reload()})),document.getElementById("notice-file-open-error-ok-btn").addEventListener("click",(()=>{location.reload()}));const a=document.getElementById("keyboard-container"),n=document.getElementById("show-keyboard-checkbox");n.addEventListener("change",(()=>{n.checked?a.classList.remove("hidden"):a.classList.add("hidden")}));const r=document.getElementById("turn-on-bgm-checkbox");r.addEventListener("change",(()=>{null!==I.pikaVolley&&(r.checked?I.pikaVolley.audio.turnBGMVolume(!0):I.pikaVolley.audio.turnBGMVolume(!1))}));const o=document.getElementById("turn-on-sfx-checkbox");o.addEventListener("change",(()=>{null!==I.pikaVolley&&(o.checked?I.pikaVolley.audio.turnSFXVolume(!0):I.pikaVolley.audio.turnSFXVolume(!1))}));const l=document.getElementById("graphic-sharp-checkbox");l.addEventListener("change",(()=>{null!==I.pikaVolley&&(l.checked?document.querySelector("#game-canvas-container>canvas").classList.remove("graphic-soft"):document.querySelector("#game-canvas-container>canvas").classList.add("graphic-soft"))})),window.addEventListener("keydown",(e=>{"Space"===e.code?(e.preventDefault(),F.click()):"ArrowLeft"===e.code?(e.preventDefault(),x.click()):"ArrowRight"===e.code&&(e.preventDefault(),M.click())}))}()}},e=>{e.O(0,[663,391,579],(()=>e(e.s=942))),e.O()}]);
//# sourceMappingURL=main_replay.bundle.js.map